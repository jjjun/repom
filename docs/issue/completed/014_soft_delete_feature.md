# Issue #014: repom ã¸ã®è«–ç†å‰Šé™¤ï¼ˆSoft Deleteï¼‰æ©Ÿèƒ½è¿½åŠ 

**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… å®Œäº†

**ä½œæˆæ—¥**: 2025-12-10

**å®Œäº†æ—¥**: 2025-12-10

**å„ªå…ˆåº¦**: é«˜

## å•é¡Œã®èª¬æ˜

ç¾åœ¨ã€repom ã«ã¯çµ±ä¸€ã•ã‚ŒãŸå‰Šé™¤æ©Ÿèƒ½ãŒå­˜åœ¨ã›ãšã€å„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ç‹¬è‡ªã«å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ç‰¹ã«ä»¥ä¸‹ã®èª²é¡ŒãŒã‚ã‚Šã¾ã™ï¼š

- mine-py ã§ã‚¢ã‚»ãƒƒãƒˆå‰Šé™¤æ™‚ã«ç‰©ç†ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚å‰Šé™¤ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
- èª¤å‰Šé™¤ã‹ã‚‰ã®å¾©å…ƒæ©Ÿèƒ½ãŒå¿…è¦
- è«–ç†å‰Šé™¤ â†’ ãƒãƒƒãƒå‡¦ç†ã§ã®ç‰©ç†å‰Šé™¤ã¨ã„ã†ãƒ•ãƒ­ãƒ¼ã‚’å®Ÿç¾ã—ãŸã„
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã”ã¨ã«å‰Šé™¤å‡¦ç†ã®å®Ÿè£…ãŒç•°ãªã‚Šã€çµ±ä¸€æ€§ãŒãªã„

## ææ¡ˆã•ã‚Œã‚‹è§£æ±ºç­–

repom ã« **SoftDeletableMixin** ã¨è«–ç†å‰Šé™¤å¯¾å¿œã® Repository ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ ã—ã€å…¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§çµ±ä¸€ã•ã‚ŒãŸå‰Šé™¤å‡¦ç†ã‚’æä¾›ã—ã¾ã™ã€‚

### ä¸»è¦æ©Ÿèƒ½

1. **SoftDeletableMixin**: `deleted_at` ã‚«ãƒ©ãƒ ã¨å‰Šé™¤æ“ä½œãƒ¡ã‚½ãƒƒãƒ‰ã‚’æä¾›
2. **BaseRepository ã®æ‹¡å¼µ**: è«–ç†å‰Šé™¤å¯¾å¿œãƒ¡ã‚½ãƒƒãƒ‰ç¾¤ã‚’è¿½åŠ 
3. **è‡ªå‹•ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°**: `find()` ãŒå‰Šé™¤æ¸ˆã¿ã‚’è‡ªå‹•é™¤å¤–
4. **å¾©å…ƒæ©Ÿèƒ½**: è«–ç†å‰Šé™¤ã—ãŸãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å¾©å…ƒå¯èƒ½
5. **ç‰©ç†å‰Šé™¤**: å®Œå…¨å‰Šé™¤ã‚‚å¯èƒ½

## å½±éŸ¿ç¯„å›²

### å½±éŸ¿ã‚’å—ã‘ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«

- `repom/base_model_auto.py` - SoftDeletableMixin è¿½åŠ 
- `repom/base_repository.py` - è«–ç†å‰Šé™¤ãƒ¡ã‚½ãƒƒãƒ‰è¿½åŠ 
- `tests/unit_tests/test_soft_delete.py` - æ–°è¦ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
- `docs/guides/soft_delete_guide.md` - æ–°è¦ã‚¬ã‚¤ãƒ‰ä½œæˆ
- `README.md` - æ©Ÿèƒ½èª¬æ˜è¿½åŠ 

### å½±éŸ¿ã‚’å—ã‘ã‚‹æ©Ÿèƒ½

- **æ—¢å­˜æ©Ÿèƒ½ã¸ã®å½±éŸ¿**: ãªã—ï¼ˆå¾Œæ–¹äº’æ›æ€§ã‚ã‚Šï¼‰
- **æ–°è¦æ©Ÿèƒ½**: è«–ç†å‰Šé™¤ã‚’ä½¿ã„ãŸã„ãƒ¢ãƒ‡ãƒ«ãŒ Mixin ã‚’ç¶™æ‰¿å¯èƒ½
- **å¤–éƒ¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: mine-pyã€ãã®ä»–ã®æ¶ˆè²»ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§åˆ©ç”¨å¯èƒ½

## å®Ÿè£…è¨ˆç”»

### Phase 1: repom ã¸ã®åŸºç›¤è¿½åŠ ï¼ˆé«˜å„ªå…ˆåº¦ï¼‰

1. **SoftDeletableMixin ã®å®Ÿè£…**
   - `deleted_at` ã‚«ãƒ©ãƒ å®šç¾©
   - `soft_delete()` ãƒ¡ã‚½ãƒƒãƒ‰
   - `restore()` ãƒ¡ã‚½ãƒƒãƒ‰
   - `is_deleted` ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£

2. **BaseRepository ã®æ‹¡å¼µ**
   - `_has_soft_delete()` - Mixin å­˜åœ¨ãƒã‚§ãƒƒã‚¯
   - `find()` - å‰Šé™¤æ¸ˆã¿è‡ªå‹•é™¤å¤–ï¼ˆæ—¢å­˜ãƒ¡ã‚½ãƒƒãƒ‰ä¿®æ­£ï¼‰
   - `find_with_deleted()` - å‰Šé™¤æ¸ˆã¿å«ã‚€æ¤œç´¢
   - `get_by_id()` - å‰Šé™¤æ¸ˆã¿è‡ªå‹•é™¤å¤–ï¼ˆæ—¢å­˜ãƒ¡ã‚½ãƒƒãƒ‰ä¿®æ­£ï¼‰
   - `get_by_id_with_deleted()` - å‰Šé™¤æ¸ˆã¿å«ã‚€å–å¾—
   - `soft_delete(id)` - è«–ç†å‰Šé™¤å®Ÿè¡Œ
   - `restore(id)` - å‰Šé™¤å¾©å…ƒ
   - `permanent_delete(id)` - ç‰©ç†å‰Šé™¤
   - `find_deleted()` - å‰Šé™¤æ¸ˆã¿ã®ã¿æ¤œç´¢
   - `find_deleted_before(date)` - æŒ‡å®šæ—¥æ™‚ã‚ˆã‚Šå‰ã®å‰Šé™¤æ¸ˆã¿ã‚’æ¤œç´¢

3. **ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®ä½œæˆ**
   - Mixin åŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
   - Repository ãƒ¡ã‚½ãƒƒãƒ‰ãƒ†ã‚¹ãƒˆ
   - è‡ªå‹•ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆ
   - ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ

4. **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ**
   - `docs/guides/soft_delete_guide.md` ä½œæˆ
   - README.md ã¸ã®æ©Ÿèƒ½èª¬æ˜è¿½åŠ 
   - ä½¿ç”¨ä¾‹ã®è¨˜è¼‰

### Phase 2: mine-py ã§ã®é©ç”¨ï¼ˆä¸­å„ªå…ˆåº¦ï¼‰

1. **AssetItemModel ã¸ã®é©ç”¨**
   - SoftDeletableMixin ã‚’ç¶™æ‰¿
   - ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆãƒ»å®Ÿè¡Œ

2. **AssetItemRepository ã®æ‹¡å¼µ**
   - `soft_delete_with_file_mark()` - è«–ç†å‰Šé™¤
   - `permanent_delete_with_file()` - ãƒ•ã‚¡ã‚¤ãƒ«å«ã‚€ç‰©ç†å‰Šé™¤
   - `get_assets_for_cleanup()` - ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å¯¾è±¡å–å¾—

3. **ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®Ÿè£…**
   - DELETE ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆè«–ç†å‰Šé™¤ï¼‰
   - POST /restore ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆå¾©å…ƒï¼‰

### Phase 3: ãƒãƒƒãƒå‡¦ç†ï¼ˆä½å„ªå…ˆåº¦ï¼‰

1. **ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚¿ã‚¹ã‚¯ä½œæˆ**
   - 30æ—¥ä»¥ä¸Šå‰ã®å‰Šé™¤æ¸ˆã¿ã‚¢ã‚»ãƒƒãƒˆã‚’ç‰©ç†å‰Šé™¤
   - ãƒ­ã‚°è¨˜éŒ²ã¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

2. **ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ç™»éŒ²**
   - å®šæœŸå®Ÿè¡Œè¨­å®š

## å®Ÿè£…ã®è©³ç´°

### 1. SoftDeletableMixin

```python
from datetime import datetime, timezone
from sqlalchemy import DateTime
from sqlalchemy.orm import Mapped, mapped_column

class SoftDeletableMixin:
    """è«–ç†å‰Šé™¤æ©Ÿèƒ½ã‚’æä¾›ã™ã‚‹ Mixin"""
    
    deleted_at: Mapped[datetime | None] = mapped_column(
        DateTime(timezone=True),
        nullable=True,
        default=None,
        index=True,
        info={'description': 'è«–ç†å‰Šé™¤æ—¥æ™‚ï¼ˆNULL = å‰Šé™¤ã•ã‚Œã¦ã„ãªã„ï¼‰'}
    )
    
    def soft_delete(self) -> None:
        """è«–ç†å‰Šé™¤ã‚’å®Ÿè¡Œ"""
        self.deleted_at = datetime.now(timezone.utc)
        
    def restore(self) -> None:
        """å‰Šé™¤ã‚’å–ã‚Šæ¶ˆã—"""
        self.deleted_at = None
        
    @property
    def is_deleted(self) -> bool:
        """å‰Šé™¤æ¸ˆã¿ã‹ã©ã†ã‹ã‚’è¿”ã™"""
        return self.deleted_at is not None
```

### 2. BaseRepository ãƒ¡ã‚½ãƒƒãƒ‰ä¾‹

```python
def soft_delete(self, id: int) -> bool:
    """è«–ç†å‰Šé™¤
    
    Args:
        id: å‰Šé™¤ã™ã‚‹ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ID
        
    Returns:
        bool: å‰Šé™¤æˆåŠŸã—ãŸã‹
        
    Raises:
        ValueError: ãƒ¢ãƒ‡ãƒ«ãŒ SoftDeletableMixin ã‚’æŒãŸãªã„å ´åˆ
    """
    if not self._has_soft_delete():
        raise ValueError(
            f"{self.model_class.__name__} does not support soft delete. "
            "Add SoftDeletableMixin to the model."
        )
    
    item = self.get_by_id(id)
    if not item:
        return False
        
    item.soft_delete()
    self.session.commit()
    return True
```

### 3. ä½¿ç”¨ä¾‹ï¼ˆmine-pyï¼‰

```python
# ãƒ¢ãƒ‡ãƒ«å®šç¾©
class AssetItemModel(BaseModelAuto, SoftDeletableMixin,
                     use_created_at=True, use_updated_at=True):
    __tablename__ = "asset_items"
    # ... ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å®šç¾©

# Repository ä½¿ç”¨
repo = AssetItemRepository()

# è«–ç†å‰Šé™¤
repo.soft_delete(asset_id)

# å¾©å…ƒ
repo.restore(asset_id)

# 30æ—¥ä»¥ä¸Šå‰ã«å‰Šé™¤ã•ã‚ŒãŸã‚‚ã®ã‚’å–å¾—
from datetime import datetime, timedelta, timezone
threshold = datetime.now(timezone.utc) - timedelta(days=30)
old_deleted = repo.find_deleted_before(threshold)

# ç‰©ç†å‰Šé™¤ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ã‚‚å‰Šé™¤ï¼‰
for asset in old_deleted:
    repo.permanent_delete_with_file(asset.id)
```

## ãƒ†ã‚¹ãƒˆè¨ˆç”»

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

1. **SoftDeletableMixin ãƒ†ã‚¹ãƒˆ**
   - `soft_delete()` ãƒ¡ã‚½ãƒƒãƒ‰ãŒ `deleted_at` ã‚’è¨­å®š
   - `restore()` ãƒ¡ã‚½ãƒƒãƒ‰ãŒ `deleted_at` ã‚’ã‚¯ãƒªã‚¢
   - `is_deleted` ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒæ­£ã—ãå‹•ä½œ

2. **BaseRepository è‡ªå‹•ãƒ•ã‚£ãƒ«ã‚¿ãƒ†ã‚¹ãƒˆ**
   - `find()` ãŒå‰Šé™¤æ¸ˆã¿ã‚’é™¤å¤–
   - `find_with_deleted()` ãŒå…¨ãƒ¬ã‚³ãƒ¼ãƒ‰å–å¾—
   - `get_by_id()` ãŒå‰Šé™¤æ¸ˆã¿ã‚’é™¤å¤–
   - `get_by_id_with_deleted()` ãŒå‰Šé™¤æ¸ˆã¿ã‚‚å–å¾—

3. **å‰Šé™¤ãƒ»å¾©å…ƒãƒ†ã‚¹ãƒˆ**
   - `soft_delete()` ãŒæ­£ã—ãè«–ç†å‰Šé™¤
   - `restore()` ãŒæ­£ã—ãå¾©å…ƒ
   - `permanent_delete()` ãŒç‰©ç†å‰Šé™¤

4. **æ¤œç´¢ãƒ†ã‚¹ãƒˆ**
   - `find_deleted()` ãŒå‰Šé™¤æ¸ˆã¿ã®ã¿å–å¾—
   - `find_deleted_before()` ãŒæ—¥æ™‚ãƒ•ã‚£ãƒ«ã‚¿å‹•ä½œ

5. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆ**
   - Mixin æœªç¶™æ‰¿ãƒ¢ãƒ‡ãƒ«ã§ `soft_delete()` ã‚’å‘¼ã¶ã¨ä¾‹å¤–
   - å­˜åœ¨ã—ãªã„ ID ã§æ“ä½œã™ã‚‹ã¨ False è¿”å´

### ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«

- `tests/unit_tests/test_soft_delete.py` - ç´„8-10å€‹ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

### æœŸå¾…ã•ã‚Œã‚‹ãƒ†ã‚¹ãƒˆçµæœ

- ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹
- ã‚«ãƒãƒ¬ãƒƒã‚¸ 95% ä»¥ä¸Š
- ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã‚‚ç¶²ç¾…

## æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ

1. **çµ±ä¸€ã•ã‚ŒãŸå‰Šé™¤å‡¦ç†**: å…¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§åŒã˜ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒä½¿ãˆã‚‹
2. **å®‰å…¨æ€§å‘ä¸Š**: èª¤å‰Šé™¤ã‹ã‚‰ã®å¾©å…ƒãŒå¯èƒ½
3. **ã‚³ãƒ¼ãƒ‰å‰Šæ¸›**: å„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§å‰Šé™¤å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹å¿…è¦ãŒãªã„
4. **ä¿å®ˆæ€§å‘ä¸Š**: å‰Šé™¤ãƒ­ã‚¸ãƒƒã‚¯ãŒ repom ã«é›†ç´„ã•ã‚Œã‚‹
5. **æ‹¡å¼µæ€§**: ä»–ã®ãƒ¢ãƒ‡ãƒ«ã§ã‚‚ç°¡å˜ã«è«–ç†å‰Šé™¤ã‚’å°å…¥å¯èƒ½

## æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã¸ã®å½±éŸ¿

- `deleted_at` ã‚«ãƒ©ãƒ ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ `NULL` ãªã®ã§ã€æ—¢å­˜ãƒ¬ã‚³ãƒ¼ãƒ‰ã¯ã€Œå‰Šé™¤ã•ã‚Œã¦ã„ãªã„ã€æ‰±ã„
- ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œå¾Œã‚‚æ—¢å­˜æ©Ÿèƒ½ã«å½±éŸ¿ãªã—
- **å¾Œæ–¹äº’æ›æ€§ã‚ã‚Š**: SoftDeletableMixin ã‚’ä½¿ã‚ãªã„ãƒ¢ãƒ‡ãƒ«ã¯å¾“æ¥é€šã‚Šå‹•ä½œ

## è³ªå•ãƒ»ç¢ºèªäº‹é …

1. **API è¨­è¨ˆã«ã¤ã„ã¦**:
   - `find()` ãŒå‰Šé™¤æ¸ˆã¿ã‚’è‡ªå‹•é™¤å¤–ã™ã‚‹ä»•æ§˜ã§è‰¯ã„ã‹ï¼Ÿ
   - æ˜ç¤ºçš„ã« `find(include_deleted=True)` ã®ã‚ˆã†ãª API ãŒå¿…è¦ã‹ï¼Ÿ

2. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**:
   - `deleted_at` ã‚«ãƒ©ãƒ ã«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä½œæˆã™ã‚‹æƒ³å®šã ãŒã€ä»–ã«æœ€é©åŒ–ãŒå¿…è¦ã‹ï¼Ÿ

3. **ãƒ­ã‚®ãƒ³ã‚°**:
   - è«–ç†å‰Šé™¤ãƒ»å¾©å…ƒãƒ»ç‰©ç†å‰Šé™¤æ™‚ã®ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã¯ã©ã†ã™ã‚‹ã‹ï¼Ÿï¼ˆINFO? WARNING?ï¼‰

4. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**:
   - è«–ç†å‰Šé™¤éå¯¾å¿œãƒ¢ãƒ‡ãƒ«ã§ `soft_delete()` ã‚’å‘¼ã‚“ã æ™‚ã«ä¾‹å¤–ã‚’æŠ•ã’ã‚‹ï¼Ÿãã‚Œã¨ã‚‚ False ã‚’è¿”ã™ï¼Ÿ
   - **ææ¡ˆ**: ä¾‹å¤–ã‚’æŠ•ã’ã‚‹ï¼ˆValueErrorï¼‰- ä½¿ç”¨æ–¹æ³•ã®èª¤ã‚Šã¯æ—©æœŸã«æ¤œå‡ºã™ã¹ã

## é–¢é€£ãƒªã‚½ãƒ¼ã‚¹

### å‚è€ƒå®Ÿè£…

- **Django ã®è«–ç†å‰Šé™¤å®Ÿè£…**: django-safedelete ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ
- **Rails ã®è«–ç†å‰Šé™¤**: paranoia gem ã®ãƒ‘ã‚¿ãƒ¼ãƒ³
- **SQLAlchemy Mixin ãƒ‘ã‚¿ãƒ¼ãƒ³**: https://docs.sqlalchemy.org/en/20/orm/declarative_mixins.html

### é–¢é€£ Issue

- mine-py: ã‚¢ã‚»ãƒƒãƒˆå‰Šé™¤æ™‚ã®ç‰©ç†ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤å‡¦ç†
- mine-py: ani_video_asset_links ä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«ã®ç®¡ç†

### é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- `docs/guides/base_model_auto_guide.md` - Mixin ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å‚è€ƒ
- `docs/guides/repository_and_utilities_guide.md` - Repository æ‹¡å¼µã®å‚è€ƒ
- `docs/guides/testing_guide.md` - ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

---

## å®Ÿè£…çµæœ

### âœ… å®Ÿè£…å®Œäº†å†…å®¹

**Phase 1: repom ã¸ã®åŸºç›¤è¿½åŠ ** - å®Œäº†

#### 1. SoftDeletableMixin ã®å®Ÿè£…
- âœ… `repom/base_model_auto.py` ã«è¿½åŠ 
- âœ… `deleted_at` ã‚«ãƒ©ãƒ ï¼ˆDateTime(timezone=True)ã€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä»˜ãï¼‰
- âœ… `soft_delete()` ãƒ¡ã‚½ãƒƒãƒ‰
- âœ… `restore()` ãƒ¡ã‚½ãƒƒãƒ‰
- âœ… `is_deleted` ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
- âœ… ãƒ­ã‚°è¨˜éŒ²æ©Ÿèƒ½ï¼ˆINFO ãƒ¬ãƒ™ãƒ«ï¼‰

#### 2. BaseRepository ã®æ‹¡å¼µ
- âœ… `repom/base_repository.py` ã‚’æ‹¡å¼µ
- âœ… `_has_soft_delete()` - Mixin å­˜åœ¨ãƒã‚§ãƒƒã‚¯
- âœ… `find(include_deleted=False)` - ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§åˆ¶å¾¡
- âœ… `get_by_id(include_deleted=False)` - ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§åˆ¶å¾¡
- âœ… `soft_delete(id)` - è«–ç†å‰Šé™¤å®Ÿè¡Œ
- âœ… `restore(id)` - å‰Šé™¤å¾©å…ƒ
- âœ… `permanent_delete(id)` - ç‰©ç†å‰Šé™¤ï¼ˆWARNING ãƒ­ã‚°ï¼‰
- âœ… `find_deleted()` - å‰Šé™¤æ¸ˆã¿ã®ã¿æ¤œç´¢
- âœ… `find_deleted_before(date)` - æ—¥æ™‚ãƒ•ã‚£ãƒ«ã‚¿

#### 3. ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
- âœ… `tests/unit_tests/test_soft_delete.py` ã‚’ä½œæˆ
- âœ… **22ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã€å…¨ãƒ‘ã‚¹**
- âœ… **æ—¢å­˜260ãƒ†ã‚¹ãƒˆã‚‚å…¨ãƒ‘ã‚¹**ï¼ˆå¾Œæ–¹äº’æ›æ€§ç¢ºèªæ¸ˆã¿ï¼‰
- âœ… ã‚«ãƒãƒ¬ãƒƒã‚¸: Mixinã€Repositoryã€çµ±åˆã‚·ãƒŠãƒªã‚ªå…¨ã¦ç¶²ç¾…

#### 4. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- âœ… `docs/guides/soft_delete_guide.md` - è©³ç´°ã‚¬ã‚¤ãƒ‰ä½œæˆ
- âœ… `README.md` - æ©Ÿèƒ½èª¬æ˜ã¨ã‚¬ã‚¤ãƒ‰ãƒªãƒ³ã‚¯è¿½åŠ 

### ğŸ“Š ãƒ†ã‚¹ãƒˆçµæœ

```
tests/unit_tests/test_soft_delete.py - 22 passed
tests/unit_tests (å…¨ä½“) - 260 passed, 0 failed
```

### ğŸ¯ å®Ÿè£…ã—ãŸä»•æ§˜ï¼ˆç¢ºå®šç‰ˆï¼‰

| é …ç›® | å®Ÿè£…å†…å®¹ |
|------|---------|
| **API è¨­è¨ˆ** | `find(include_deleted=False)` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ–¹å¼ |
| **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°** | `ValueError` ä¾‹å¤–ï¼ˆè«–ç†å‰Šé™¤éå¯¾å¿œãƒ¢ãƒ‡ãƒ«ï¼‰ |
| **ãƒ­ã‚®ãƒ³ã‚°** | INFOï¼ˆè«–ç†å‰Šé™¤ãƒ»å¾©å…ƒï¼‰/ WARNINGï¼ˆç‰©ç†å‰Šé™¤ï¼‰ |
| **ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹** | `deleted_at` ã«è‡ªå‹•çš„ã« `index=True` |
| **å¾Œæ–¹äº’æ›æ€§** | âœ… æ—¢å­˜ã‚³ãƒ¼ãƒ‰å½±éŸ¿ãªã— |

### ğŸ“š æˆæœç‰©

1. **å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**
   - `repom/base_model_auto.py` - SoftDeletableMixin è¿½åŠ 
   - `repom/base_repository.py` - è«–ç†å‰Šé™¤ãƒ¡ã‚½ãƒƒãƒ‰è¿½åŠ 

2. **ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«**
   - `tests/unit_tests/test_soft_delete.py` - 22ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

3. **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**
   - `docs/guides/soft_delete_guide.md` - å®Œå…¨ã‚¬ã‚¤ãƒ‰
   - `README.md` - æ©Ÿèƒ½èª¬æ˜ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¿½åŠ 

### ğŸš€ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ï¼ˆmine-py ã§ã®é©ç”¨ï¼‰

Phase 2 ã¯åˆ¥é€”å®Ÿæ–½äºˆå®šï¼š
1. AssetItemModel ã« SoftDeletableMixin é©ç”¨
2. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆãƒ»å®Ÿè¡Œ
3. Repository æ‹¡å¼µï¼ˆãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
4. ãƒãƒƒãƒå‡¦ç†å®Ÿè£…

---

**æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—**: Phase 1 ã®å®Ÿè£…é–‹å§‹ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼æ‰¿èªå¾Œï¼‰
